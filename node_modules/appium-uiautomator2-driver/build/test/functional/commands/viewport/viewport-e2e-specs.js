'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _pngjs = require('pngjs');

var _desired = require('../../desired');

var _helpersSession = require('../../helpers/session');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var driver = undefined;

describe('testViewportCommands', function () {
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(_desired.SCROLL_CAPS));

        case 2:
          driver = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!driver) {
            context$2$0.next = 3;
            break;
          }

          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.quit());

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get device pixel ratio, status bar height, and viewport rect', function callee$1$0() {
    var _ref, viewportRect, statBarHeight, pixelRatio;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.sessionCapabilities());

        case 2:
          _ref = context$2$0.sent;
          viewportRect = _ref.viewportRect;
          statBarHeight = _ref.statBarHeight;
          pixelRatio = _ref.pixelRatio;

          pixelRatio.should.exist;
          pixelRatio.should.not.equal(0);
          statBarHeight.should.exist;
          statBarHeight.should.not.equal(0);
          viewportRect.should.exist;
          viewportRect.left.should.exist;
          viewportRect.top.should.exist;
          viewportRect.width.should.exist;
          viewportRect.height.should.exist;

        case 15:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get scrollable element', function callee$1$0() {
    var scrollableEl;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@scrollable="true"]'));

        case 2:
          scrollableEl = context$2$0.sent;

          scrollableEl.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get content size from scrollable element found as uiobject', function callee$1$0() {
    var scrollableEl, contentSize;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@scrollable="true"]'));

        case 2:
          scrollableEl = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(scrollableEl.getAttribute("contentSize"));

        case 5:
          contentSize = context$2$0.sent;

          contentSize.should.exist;
          JSON.parse(contentSize).scrollableOffset.should.exist;

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get content size from scrollable element found as uiobject2', function callee$1$0() {
    var scrollableEl, contentSize;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//android.widget.ScrollView'));

        case 2:
          scrollableEl = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(scrollableEl.getAttribute("contentSize"));

        case 5:
          contentSize = context$2$0.sent;

          contentSize.should.exist;
          JSON.parse(contentSize).scrollableOffset.should.exist;

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get first element from scrollable element', function callee$1$0() {
    var scrollableEl, element;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@scrollable="true"]'));

        case 2:
          scrollableEl = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(scrollableEl.elementByXPath('/*[@firstVisible="true"]'));

        case 5:
          element = context$2$0.sent;

          element.should.exist;

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get a cropped screenshot of the viewport without statusbar', function callee$1$0() {
    var _ref2, viewportRect, statBarHeight, fullScreen, viewScreen, fullB64, viewB64, fullImg, viewImg;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.sessionCapabilities());

        case 2:
          _ref2 = context$2$0.sent;
          viewportRect = _ref2.viewportRect;
          statBarHeight = _ref2.statBarHeight;
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.takeScreenshot());

        case 7:
          fullScreen = context$2$0.sent;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(driver.execute("mobile: viewportScreenshot"));

        case 10:
          viewScreen = context$2$0.sent;
          fullB64 = new Buffer(fullScreen, 'base64');
          viewB64 = new Buffer(viewScreen, 'base64');
          fullImg = new _pngjs.PNG({ filterType: 4 });
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(_bluebird2['default'].promisify(fullImg.parse).call(fullImg, fullB64));

        case 16:
          viewImg = new _pngjs.PNG({ filterType: 4 });
          context$2$0.next = 19;
          return _regeneratorRuntime.awrap(_bluebird2['default'].promisify(viewImg.parse).call(viewImg, viewB64));

        case 19:
          viewportRect.top.should.eql(statBarHeight);
          viewImg.height.should.eql(viewportRect.height);
          viewImg.width.should.eql(fullImg.width);
          fullImg.height.should.be.above(viewImg.height);

        case 23:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy92aWV3cG9ydC92aWV3cG9ydC1lMmUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O29CQUFpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7Ozt3QkFDL0IsVUFBVTs7OztxQkFDSixPQUFPOzt1QkFDQyxlQUFlOzs4QkFDaEIsdUJBQXVCOztBQUVsRCxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLElBQUksTUFBTSxZQUFBLENBQUM7O0FBRVgsUUFBUSxDQUFDLHNCQUFzQixFQUFFLFlBQVk7QUFDM0MsUUFBTSxDQUFDOzs7OzsyQ0FDVSxxREFBdUI7OztBQUF0QyxnQkFBTTs7Ozs7OztHQUNQLENBQUMsQ0FBQztBQUNILE9BQUssQ0FBQzs7OztlQUNBLE1BQU07Ozs7OzsyQ0FDRixNQUFNLENBQUMsSUFBSSxFQUFFOzs7Ozs7O0dBRXRCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMscUVBQXFFLEVBQUU7Y0FDakUsWUFBWSxFQUFFLGFBQWEsRUFBRSxVQUFVOzs7Ozs7MkNBQVUsTUFBTSxDQUFDLG1CQUFtQixFQUFFOzs7O0FBQTdFLHNCQUFZLFFBQVosWUFBWTtBQUFFLHVCQUFhLFFBQWIsYUFBYTtBQUFFLG9CQUFVLFFBQVYsVUFBVTs7QUFDOUMsb0JBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3hCLG9CQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsdUJBQWEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQzNCLHVCQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEMsc0JBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQzFCLHNCQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENB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QUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMzQyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN4QyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7Ozs7R0FDaEQsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy92aWV3cG9ydC92aWV3cG9ydC1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IFBORyB9IGZyb20gJ3BuZ2pzJztcbmltcG9ydCB7IFNDUk9MTF9DQVBTIH0gZnJvbSAnLi4vLi4vZGVzaXJlZCc7XG5pbXBvcnQgeyBpbml0RHJpdmVyIH0gZnJvbSAnLi4vLi4vaGVscGVycy9zZXNzaW9uJztcblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxubGV0IGRyaXZlcjtcblxuZGVzY3JpYmUoJ3Rlc3RWaWV3cG9ydENvbW1hbmRzJywgZnVuY3Rpb24gKCkge1xuICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGRyaXZlciA9IGF3YWl0IGluaXREcml2ZXIoU0NST0xMX0NBUFMpO1xuICB9KTtcbiAgYWZ0ZXIoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGlmIChkcml2ZXIpIHtcbiAgICAgIGF3YWl0IGRyaXZlci5xdWl0KCk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBkZXZpY2UgcGl4ZWwgcmF0aW8sIHN0YXR1cyBiYXIgaGVpZ2h0LCBhbmQgdmlld3BvcnQgcmVjdCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB7dmlld3BvcnRSZWN0LCBzdGF0QmFySGVpZ2h0LCBwaXhlbFJhdGlvfSA9IGF3YWl0IGRyaXZlci5zZXNzaW9uQ2FwYWJpbGl0aWVzKCk7XG4gICAgcGl4ZWxSYXRpby5zaG91bGQuZXhpc3Q7XG4gICAgcGl4ZWxSYXRpby5zaG91bGQubm90LmVxdWFsKDApO1xuICAgIHN0YXRCYXJIZWlnaHQuc2hvdWxkLmV4aXN0O1xuICAgIHN0YXRCYXJIZWlnaHQuc2hvdWxkLm5vdC5lcXVhbCgwKTtcbiAgICB2aWV3cG9ydFJlY3Quc2hvdWxkLmV4aXN0O1xuICAgIHZpZXdwb3J0UmVjdC5sZWZ0LnNob3VsZC5leGlzdDtcbiAgICB2aWV3cG9ydFJlY3QudG9wLnNob3VsZC5leGlzdDtcbiAgICB2aWV3cG9ydFJlY3Qud2lkdGguc2hvdWxkLmV4aXN0O1xuICAgIHZpZXdwb3J0UmVjdC5oZWlnaHQuc2hvdWxkLmV4aXN0O1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBzY3JvbGxhYmxlIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNjcm9sbGFibGVFbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aCgnLy8qW0BzY3JvbGxhYmxlPVwidHJ1ZVwiXScpO1xuICAgIHNjcm9sbGFibGVFbC5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZ2V0IGNvbnRlbnQgc2l6ZSBmcm9tIHNjcm9sbGFibGUgZWxlbWVudCBmb3VuZCBhcyB1aW9iamVjdCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2Nyb2xsYWJsZUVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKCcvLypbQHNjcm9sbGFibGU9XCJ0cnVlXCJdJyk7XG4gICAgbGV0IGNvbnRlbnRTaXplID0gYXdhaXQgc2Nyb2xsYWJsZUVsLmdldEF0dHJpYnV0ZShcImNvbnRlbnRTaXplXCIpO1xuICAgIGNvbnRlbnRTaXplLnNob3VsZC5leGlzdDtcbiAgICBKU09OLnBhcnNlKGNvbnRlbnRTaXplKS5zY3JvbGxhYmxlT2Zmc2V0LnNob3VsZC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgY29udGVudCBzaXplIGZyb20gc2Nyb2xsYWJsZSBlbGVtZW50IGZvdW5kIGFzIHVpb2JqZWN0MicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2Nyb2xsYWJsZUVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKCcvL2FuZHJvaWQud2lkZ2V0LlNjcm9sbFZpZXcnKTtcbiAgICBsZXQgY29udGVudFNpemUgPSBhd2FpdCBzY3JvbGxhYmxlRWwuZ2V0QXR0cmlidXRlKFwiY29udGVudFNpemVcIik7XG4gICAgY29udGVudFNpemUuc2hvdWxkLmV4aXN0O1xuICAgIEpTT04ucGFyc2UoY29udGVudFNpemUpLnNjcm9sbGFibGVPZmZzZXQuc2hvdWxkLmV4aXN0O1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBmaXJzdCBlbGVtZW50IGZyb20gc2Nyb2xsYWJsZSBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBzY3JvbGxhYmxlRWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoJy8vKltAc2Nyb2xsYWJsZT1cInRydWVcIl0nKTtcbiAgICBsZXQgZWxlbWVudCA9IGF3YWl0IHNjcm9sbGFibGVFbC5lbGVtZW50QnlYUGF0aCgnLypbQGZpcnN0VmlzaWJsZT1cInRydWVcIl0nKTtcbiAgICBlbGVtZW50LnNob3VsZC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgYSBjcm9wcGVkIHNjcmVlbnNob3Qgb2YgdGhlIHZpZXdwb3J0IHdpdGhvdXQgc3RhdHVzYmFyJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHt2aWV3cG9ydFJlY3QsIHN0YXRCYXJIZWlnaHR9ID0gYXdhaXQgZHJpdmVyLnNlc3Npb25DYXBhYmlsaXRpZXMoKTtcbiAgICBjb25zdCBmdWxsU2NyZWVuID0gYXdhaXQgZHJpdmVyLnRha2VTY3JlZW5zaG90KCk7XG4gICAgY29uc3Qgdmlld1NjcmVlbiA9IGF3YWl0IGRyaXZlci5leGVjdXRlKFwibW9iaWxlOiB2aWV3cG9ydFNjcmVlbnNob3RcIik7XG4gICAgY29uc3QgZnVsbEI2NCA9IG5ldyBCdWZmZXIoZnVsbFNjcmVlbiwgJ2Jhc2U2NCcpO1xuICAgIGNvbnN0IHZpZXdCNjQgPSBuZXcgQnVmZmVyKHZpZXdTY3JlZW4sICdiYXNlNjQnKTtcbiAgICBjb25zdCBmdWxsSW1nID0gbmV3IFBORyh7ZmlsdGVyVHlwZTogNH0pO1xuICAgIGF3YWl0IEIucHJvbWlzaWZ5KGZ1bGxJbWcucGFyc2UpLmNhbGwoZnVsbEltZywgZnVsbEI2NCk7XG4gICAgY29uc3Qgdmlld0ltZyA9IG5ldyBQTkcoe2ZpbHRlclR5cGU6IDR9KTtcbiAgICBhd2FpdCBCLnByb21pc2lmeSh2aWV3SW1nLnBhcnNlKS5jYWxsKHZpZXdJbWcsIHZpZXdCNjQpO1xuICAgIHZpZXdwb3J0UmVjdC50b3Auc2hvdWxkLmVxbChzdGF0QmFySGVpZ2h0KTtcbiAgICB2aWV3SW1nLmhlaWdodC5zaG91bGQuZXFsKHZpZXdwb3J0UmVjdC5oZWlnaHQpO1xuICAgIHZpZXdJbWcud2lkdGguc2hvdWxkLmVxbChmdWxsSW1nLndpZHRoKTtcbiAgICBmdWxsSW1nLmhlaWdodC5zaG91bGQuYmUuYWJvdmUodmlld0ltZy5oZWlnaHQpO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
