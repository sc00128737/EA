'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _desired = require('../desired');

var _helpersSession = require('../helpers/session');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var caps = _lodash2['default'].defaults({
  appPackage: 'io.appium.android.apis',
  appActivity: '.view.WebView1',
  showChromedriverLog: true
}, _desired.APIDEMOS_CAPS);

describe('apidemo - context', function () {
  var driver = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(caps));

        case 2:
          driver = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.quit());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should find webview context', function callee$1$0() {
    var contexts;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.contexts());

        case 2:
          contexts = context$2$0.sent;

          contexts.length.should.be.at.least(2);

          // make sure the process was found, otherwise it comes out as "undefined"
          contexts.join('').should.not.include('undefined');
          contexts.join('').should.include('WEBVIEW_io.appium.android.apis');

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should go into the webview', function callee$1$0() {
    var contexts;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          // TODO: Fix this on TestObject. Chromedriver does not exist error
          if (process.env.TESTOBJECT_E2E_TESTS) {
            this.skip();
          }
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.contexts());

        case 3:
          contexts = context$2$0.sent;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.context(contexts[1]));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9jb250ZXh0LWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNmLFlBQVk7OzhCQUNmLG9CQUFvQjs7c0JBQ2pDLFFBQVE7Ozs7QUFHdEIsa0JBQUssTUFBTSxFQUFFLENBQUM7QUFDZCxrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixJQUFNLElBQUksR0FBRyxvQkFBRSxRQUFRLENBQUM7QUFDdEIsWUFBVSxFQUFFLHdCQUF3QjtBQUNwQyxhQUFXLEVBQUUsZ0JBQWdCO0FBQzdCLHFCQUFtQixFQUFFLElBQUk7Q0FDMUIseUJBQWdCLENBQUM7O0FBRWxCLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxZQUFZO0FBQ3hDLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUM7Ozs7OzJDQUNVLGdDQUFXLElBQUksQ0FBQzs7O0FBQS9CLGdCQUFNOzs7Ozs7O0dBQ1AsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDOzs7OzsyQ0FDRSxNQUFNLENBQUMsSUFBSSxFQUFFOzs7Ozs7O0dBQ3BCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM1QixRQUFROzs7OzsyQ0FBUyxNQUFNLENBQUMsUUFBUSxFQUFFOzs7QUFBbEMsa0JBQVE7O0FBQ1osa0JBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7QUFHdEMsa0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDbEQsa0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3BFLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw0QkFBNEIsRUFBRTtRQUszQixRQUFROzs7OztBQUhaLGNBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRTtBQUNwQyxnQkFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1dBQ2I7OzJDQUNvQixNQUFNLENBQUMsUUFBUSxFQUFFOzs7QUFBbEMsa0JBQVE7OzJDQUNOLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ2xDLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2Z1bmN0aW9uYWwvY29tbWFuZHMvY29udGV4dC1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7IEFQSURFTU9TX0NBUFMgfSBmcm9tICcuLi9kZXNpcmVkJztcbmltcG9ydCB7IGluaXREcml2ZXIgfSBmcm9tICcuLi9oZWxwZXJzL3Nlc3Npb24nO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBjYXBzID0gXy5kZWZhdWx0cyh7XG4gIGFwcFBhY2thZ2U6ICdpby5hcHBpdW0uYW5kcm9pZC5hcGlzJyxcbiAgYXBwQWN0aXZpdHk6ICcudmlldy5XZWJWaWV3MScsXG4gIHNob3dDaHJvbWVkcml2ZXJMb2c6IHRydWUsXG59LCBBUElERU1PU19DQVBTKTtcblxuZGVzY3JpYmUoJ2FwaWRlbW8gLSBjb250ZXh0JywgZnVuY3Rpb24gKCkge1xuICBsZXQgZHJpdmVyO1xuICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGRyaXZlciA9IGF3YWl0IGluaXREcml2ZXIoY2Fwcyk7XG4gIH0pO1xuICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgYXdhaXQgZHJpdmVyLnF1aXQoKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCB3ZWJ2aWV3IGNvbnRleHQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNvbnRleHRzID0gYXdhaXQgZHJpdmVyLmNvbnRleHRzKCk7XG4gICAgY29udGV4dHMubGVuZ3RoLnNob3VsZC5iZS5hdC5sZWFzdCgyKTtcblxuICAgIC8vIG1ha2Ugc3VyZSB0aGUgcHJvY2VzcyB3YXMgZm91bmQsIG90aGVyd2lzZSBpdCBjb21lcyBvdXQgYXMgXCJ1bmRlZmluZWRcIlxuICAgIGNvbnRleHRzLmpvaW4oJycpLnNob3VsZC5ub3QuaW5jbHVkZSgndW5kZWZpbmVkJyk7XG4gICAgY29udGV4dHMuam9pbignJykuc2hvdWxkLmluY2x1ZGUoJ1dFQlZJRVdfaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBnbyBpbnRvIHRoZSB3ZWJ2aWV3JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIC8vIFRPRE86IEZpeCB0aGlzIG9uIFRlc3RPYmplY3QuIENocm9tZWRyaXZlciBkb2VzIG5vdCBleGlzdCBlcnJvclxuICAgIGlmIChwcm9jZXNzLmVudi5URVNUT0JKRUNUX0UyRV9URVNUUykge1xuICAgICAgdGhpcy5za2lwKCk7XG4gICAgfVxuICAgIGxldCBjb250ZXh0cyA9IGF3YWl0IGRyaXZlci5jb250ZXh0cygpO1xuICAgIGF3YWl0IGRyaXZlci5jb250ZXh0KGNvbnRleHRzWzFdKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
